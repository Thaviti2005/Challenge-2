<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sport Car Designer Dashboard</title>
  <style>
    :root{
      --bg: #0b0f14;
      --panel: #121821;
      --accent: #6ee7ff;
      --text: #e6eef7;
      --muted: #8ea2b3;
      --card: rgba(255,255,255,0.04);
      --ring: rgba(110,231,255,.35);
      --ok: #10b981;
      --warn: #f59e0b;
      --danger: #ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 600px at 75% 10%, rgba(110,231,255,0.12), transparent 60%), var(--bg);
      color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    .app{
      display:grid; grid-template-columns: 330px 1fr; gap:18px; height:100%; padding:18px; align-items:stretch;
    }
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.06);
      border-radius:18px; padding:16px; box-shadow: 0 10px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }
    .panel h2{margin:6px 0 14px 0; font-size:18px; letter-spacing:.3px; color:var(--text)}
    .controls{display:flex; flex-direction:column; gap:14px;}
    .row{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center}
    .row label{font-size:13px; color:var(--muted)}
    .row .val{font-size:12px; color:var(--text); opacity:.9}

    input[type="color"]{
      width:44px; height:32px; border:none; background:transparent; padding:0; cursor:pointer;
    }
    input[type="range"]{ width:100% }
    .seg{display:flex; gap:8px; flex-wrap:wrap}
    .seg button{
      flex:1 1 auto; padding:8px 10px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.02);
      color:var(--text); cursor:pointer; transition:.2s transform, .2s background, .2s border-color;
    }
    .seg button.active{ border-color:var(--ring); box-shadow:0 0 0 3px var(--ring) inset;}
    .seg button:hover{transform: translateY(-1px)}

    select, input[type="number"], input[type="text"]{
      width:100%; padding:8px 10px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.03);
      color:var(--text); outline:none;
    }

    .btnbar{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .btn{ padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:var(--text); cursor:pointer; }
    .btn:hover{ filter:brightness(1.08) }
    .btn.primary{ border-color: var(--ring); box-shadow:0 0 0 2px var(--ring) inset; }
    .btn.good{ border-color: rgba(16,185,129,.35) }
    .btn.warn{ border-color: rgba(245,158,11,.35) }

    /* Preview area */
    .stage{
      display:grid; grid-template-rows: auto 1fr; gap:12px;
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.06); border-radius:18px;
    }
    .title{font-weight:700; letter-spacing:.3px}

    .canvas{
      position:relative; height:100%; display:grid; place-items:center; background:radial-gradient(800px 280px at 50% 110%, rgba(110,231,255,.08), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.06); border-radius:18px; overflow:hidden;
    }
    .ground{
      position:absolute; left:0; right:0; bottom:14%; height:2px; background:linear-gradient(90deg, transparent, rgba(255,255,255,.35), transparent);
      filter: blur(.4px);
    }
    .badge{
      position:absolute; top:14px; right:14px; font-size:11px; color:var(--muted); opacity:.9;
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); padding:6px 8px; border-radius:999px;
    }

    /* Responsive */
    @media (max-width: 900px){
      .app{ grid-template-columns: 1fr; height:auto; }
      .canvas{ min-height: 58vh }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- LEFT: Controls -->
    <aside class="panel">
      <h2>Configurator</h2>
      <div class="controls">
        <div class="row">
          <label for="modelName">Model name</label>
          <input id="modelName" type="text" placeholder="e.g., Vortex GT" value="Vortex GT" />
        </div>
        <div class="row">
          <label for="bodyColor">Body color</label>
          <input id="bodyColor" type="color" value="#ff3b3b" />
        </div>
        <div class="row">
          <label for="accentColor">Accent / Stripe</label>
          <input id="accentColor" type="color" value="#00e5ff" />
        </div>
        <div class="row">
          <label for="underglow">Underglow</label>
          <input id="underglow" type="color" value="#00e5ff" />
        </div>
        <div class="row">
          <label for="rimStyle">Rim style</label>
          <select id="rimStyle">
            <option value="split5">Split 5</option>
            <option value="mesh">Mesh</option>
            <option value="turbine">Turbine</option>
          </select>
        </div>
        <div class="row">
          <label for="wheel">Wheel size</label>
          <div class="val"><span id="wheelVal">20</span>”</div>
          <input id="wheel" type="range" min="16" max="24" step="1" value="20" />
        </div>
        <div class="row">
          <label for="ride">Ride height</label>
          <div class="val"><span id="rideVal">-15</span> mm</div>
          <input id="ride" type="range" min="-40" max="40" step="1" value="-15" />
        </div>
        <div class="row">
          <label for="tint">Window tint</label>
          <div class="val"><span id="tintVal">35</span>%</div>
          <input id="tint" type="range" min="0" max="90" step="5" value="35" />
        </div>
        <div class="row">
          <label for="stripe">Racing stripe</label>
          <div class="seg" id="stripe">
            <button data-val="off" class="active">Off</button>
            <button data-val="center">Center</button>
            <button data-val="dual">Dual</button>
          </div>
        </div>
        <div class="row">
          <label for="spoiler">Rear spoiler</label>
          <div class="seg" id="spoiler">
            <button data-val="off" class="active">Off</button>
            <button data-val="lip">Lip</button>
            <button data-val="gt">GT Wing</button>
          </div>
        </div>
        <div class="btnbar">
          <button id="save" class="btn primary">Save preset</button>
          <button id="load" class="btn">Load preset</button>
          <button id="random" class="btn warn">Randomize</button>
          <button id="reset" class="btn">Reset</button>
          <button id="exportPNG" class="btn good">Export PNG</button>
        </div>
      </div>
      <small style="display:block; margin-top:14px; color:var(--muted)">Presets are stored locally in your browser.</small>
    </aside>

    <!-- RIGHT: Stage / Preview -->
    <section class="stage">
      <div class="topbar">
        <div class="title" id="title">Vortex GT</div>
        <div style="display:flex; gap:10px; align-items:center">
          <label style="font-size:12px; color:var(--muted); display:flex; align-items:center; gap:8px">
            <input id="darkMode" type="checkbox" checked /> Dark mode
          </label>
        </div>
      </div>
      <div class="panel canvas">
        <div class="badge">Drag the car to see underglow ✨</div>
        <div class="ground"></div>
        <svg id="carSvg" width="940" height="420" viewBox="0 0 940 420" xmlns="http://www.w3.org/2000/svg" style="max-width:92%; height:auto; cursor:grab">
          <defs>
            <filter id="drop" x="-20%" y="-20%" width="140%" height="160%">
              <feGaussianBlur in="SourceAlpha" stdDeviation="6"/>
              <feOffset dy="2"/>
              <feComponentTransfer>
                <feFuncA type="linear" slope="0.35"/>
              </feComponentTransfer>
              <feMerge>
                <feMergeNode/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
            <linearGradient id="glass" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#ffffff" stop-opacity=".55"/>
              <stop offset="1" stop-color="#cbd5e1" stop-opacity=".2"/>
            </linearGradient>
            <clipPath id="windowClip">
              <path id="windowPath" d="M350 120 C 420 95, 545 95, 640 125 L 610 175 L 370 175 Z" />
            </clipPath>
            
            <!-- Rim patterns -->
            <g id="rim_split5">
              <circle cx="0" cy="0" r="88" fill="#0b0f14"/>
              <g stroke="#d1d5db" stroke-width="7" stroke-linecap="round">
                <line x1="0" y1="-70" x2="0" y2="-20"/>
                <line x1="66" y1="-35" x2="19" y2="-10"/>
                <line x1="66" y1="35" x2="19" y2="10"/>
                <line x1="0" y1="70" x2="0" y2="20"/>
                <line x1="-66" y1="35" x2="-19" y2="10"/>
                <line x1="-66" y1="-35" x2="-19" y2="-10"/>
              </g>
              <circle cx="0" cy="0" r="14" fill="#9ca3af"/>
            </g>
            <g id="rim_mesh">
              <circle cx="0" cy="0" r="88" fill="#0b0f14"/>
              <g stroke="#d1d5db" stroke-width="5">
                <path d="M-70,-70 L70,70 M-70,70 L70,-70 M0,-88 L0,88 M-88,0 L88,0 M-62,-30 L62,30 M-62,30 L62,-30"/>
              </g>
              <circle cx="0" cy="0" r="16" fill="#9ca3af"/>
            </g>
            <g id="rim_turbine">
              <circle cx="0" cy="0" r="88" fill="#0b0f14"/>
              <g fill="#d1d5db">
                <path d="M-12,-75 C 30,-78 40,-40 35,-10 C 15,-5 2,-15 -12,-35 Z"/>
                <use href="#blade"/>
              </g>
              <circle cx="0" cy="0" r="18" fill="#9ca3af"/>
            </g>
          </defs>

          <!-- Underglow -->
          <ellipse id="underGlow" cx="470" cy="315" rx="290" ry="26" fill="#00e5ff" opacity="0.0" filter="url(#drop)"/>

          <!-- Car Group (draggable) -->
          <g id="car" filter="url(#drop)" transform="translate(0,0)">
            <!-- Body -->
            <g id="bodyGroup">
              <path id="bodyPaint" d="M120 240 C 160 150, 260 120, 370 120 C 470 118, 600 130, 740 160 C 790 180, 820 210, 830 240 C 835 255, 830 270, 820 275 L 810 280 L 820 295 L 790 310 L 720 310 L 200 310 L 160 300 L 130 280 C 115 270, 110 255, 120 240 Z" fill="#ff3b3b"/>
              <!-- Windows -->
              <g clip-path="url(#windowClip)">
                <rect x="345" y="100" width="310" height="90" fill="url(#glass)"/>
                <rect id="tintGlass" x="345" y="100" width="310" height="90" fill="#000" opacity="0.3"/>
              </g>
              <!-- Details -->
              <rect x="740" y="250" width="60" height="12" rx="6" fill="#cbd5e1"/>
              <circle cx="205" cy="175" r="6" fill="#cbd5e1"/>
            </g>

            <!-- Spoilers -->
            <g id="spoiler_lip" opacity="0">
              <path d="M780 230 L 840 230 L 835 235 L 785 235 Z" fill="#111827"/>
            </g>
            <g id="spoiler_gt" opacity="0">
              <rect x="770" y="185" width="10" height="50" rx="2" fill="#111827"/>
              <rect x="840" y="185" width="10" height="50" rx="2" fill="#111827"/>
              <rect x="760" y="180" width="110" height="14" rx="4" fill="#111827"/>
            </g>

            <!-- Stripes -->
            <g id="stripes" opacity="0">
              <rect id="stripe_center" x="470" y="108" width="24" height="220" fill="#00e5ff" rx="2"/>
              <g id="stripe_dual">
                <rect x="450" y="108" width="14" height="220" rx="2"/>
                <rect x="496" y="108" width="14" height="220" rx="2"/>
              </g>
            </g>

            <!-- Wheels -->
            <g id="wheelFront" transform="translate(690,306)">
              <circle r="92" fill="#111827"/>
              <use id="rimFront" href="#rim_split5"/>
            </g>
            <g id="wheelRear" transform="translate(260,306)">
              <circle r="92" fill="#111827"/>
              <use id="rimRear" href="#rim_split5"/>
            </g>
          </g>
        </svg>
      </div>
    </section>
  </div>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const config = {
      name: 'Vortex GT',
      body: '#ff3b3b',
      accent: '#00e5ff',
      underglow: '#00e5ff',
      rim: 'split5',
      wheel: 20,
      ride: -15,
      tint: 35,
      stripe: 'off',
      spoiler: 'off',
      dark: true,
    };

    // Elements
    const bodyPaint = $('#bodyPaint');
    const tintGlass = $('#tintGlass');
    const stripes = $('#stripes');
    const stripeCenter = $('#stripe_center');
    const stripeDual = $('#stripe_dual');
    const spoilerLip = $('#spoiler_lip');
    const spoilerGT = $('#spoiler_gt');
    const underGlow = $('#underGlow');
    const carGroup = $('#car');
    const rimFront = $('#rimFront');
    const rimRear = $('#rimRear');
    const title = $('#title');

    // Inputs
    const iName = $('#modelName');
    const iBody = $('#bodyColor');
    const iAccent = $('#accentColor');
    const iUnder = $('#underglow');
    const iRim = $('#rimStyle');
    const iWheel = $('#wheel');
    const iRide = $('#ride');
    const iTint = $('#tint');
    const segStripe = $('#stripe');
    const segSpoiler = $('#spoiler');
    const chkDark = $('#darkMode');

    const wheelVal = $('#wheelVal');
    const rideVal = $('#rideVal');
    const tintVal = $('#tintVal');

    function apply(){
      // Title & name
      title.textContent = config.name;

      // Body paint
      bodyPaint.setAttribute('fill', config.body);

      // Stripes
      stripes.setAttribute('opacity', config.stripe === 'off' ? 0 : 1);
      stripeCenter.setAttribute('fill', config.accent);
      [...stripeDual.children].forEach(r => r.setAttribute('fill', config.accent));
      stripeCenter.setAttribute('opacity', config.stripe === 'center' ? 1 : 0);
      stripeDual.setAttribute('opacity', config.stripe === 'dual' ? 1 : 0);

      // Spoiler
      spoilerLip.setAttribute('opacity', config.spoiler === 'lip' ? 1 : 0);
      spoilerGT.setAttribute('opacity', config.spoiler === 'gt' ? 1 : 0);

      // Tint (0 -> no tint / 90 -> very dark)
      const tintAlpha = Math.min(0.9, Math.max(0, config.tint/100));
      tintGlass.setAttribute('opacity', tintAlpha);

      // Rims & wheel size
      const href = {
        split5: '#rim_split5',
        mesh: '#rim_mesh',
        turbine: '#rim_turbine',
      }[config.rim] || '#rim_split5';
      rimFront.setAttribute('href', href);
      rimRear.setAttribute('href', href);

      // Wheel diameter visual scaling (base 20")
      const scale = config.wheel / 20;
      $('#wheelFront').setAttribute('transform', `translate(690,${306 - config.ride/5}) scale(${scale})`);
      $('#wheelRear').setAttribute('transform', `translate(260,${306 - config.ride/5}) scale(${scale})`);

      // Ride height (move body)
      const bodyY = -config.ride/6; // smaller movement for body
      carGroup.setAttribute('transform', `translate(0,${bodyY})`);

      // Underglow
      underGlow.setAttribute('fill', config.underglow);
      underGlow.setAttribute('opacity', 0.22);

      // Dark mode
      document.body.style.setProperty('--bg', config.dark ? '#0b0f14' : '#f6f8fb');
      document.body.style.setProperty('--text', config.dark ? '#e6eef7' : '#0b0f14');
      document.body.style.setProperty('--panel', config.dark ? '#121821' : '#ffffff');
      document.body.style.background = config.dark
        ? 'radial-gradient(1200px 600px at 75% 10%, rgba(110,231,255,0.12), transparent 60%), #0b0f14'
        : 'radial-gradient(1200px 600px at 75% 10%, rgba(17,24,39,0.04), transparent 60%), #f6f8fb';
    }

    function bindSeg(container, key){
      container.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          container.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          config[key] = btn.dataset.val;
          apply();
        });
      });
    }

    function syncUI(){
      iName.value = config.name; iBody.value = config.body; iAccent.value = config.accent; iUnder.value = config.underglow; iRim.value = config.rim;
      iWheel.value = config.wheel; wheelVal.textContent = config.wheel;
      iRide.value = config.ride; rideVal.textContent = config.ride;
      iTint.value = config.tint; tintVal.textContent = config.tint;
      segStripe.querySelectorAll('button').forEach(b=>b.classList.toggle('active', b.dataset.val===config.stripe));
      segSpoiler.querySelectorAll('button').forEach(b=>b.classList.toggle('active', b.dataset.val===config.spoiler));
      chkDark.checked = config.dark;
    }

    // Input listeners
    iName.addEventListener('input', () => { config.name = iName.value; apply(); });
    iBody.addEventListener('input', () => { config.body = iBody.value; apply(); });
    iAccent.addEventListener('input', () => { config.accent = iAccent.value; apply(); });
    iUnder.addEventListener('input', () => { config.underglow = iUnder.value; apply(); });
    iRim.addEventListener('change', () => { config.rim = iRim.value; apply(); });
    iWheel.addEventListener('input', () => { config.wheel = +iWheel.value; wheelVal.textContent = iWheel.value; apply(); });
    iRide.addEventListener('input', () => { config.ride = +iRide.value; rideVal.textContent = iRide.value; apply(); });
    iTint.addEventListener('input', () => { config.tint = +iTint.value; tintVal.textContent = iTint.value; apply(); });
    bindSeg(segStripe, 'stripe');
    bindSeg(segSpoiler, 'spoiler');
    chkDark.addEventListener('change', () => { config.dark = chkDark.checked; apply(); });

    // Save / Load / Reset / Randomize
    $('#save').addEventListener('click', () => {
      localStorage.setItem('sportcar_config', JSON.stringify(config));
      toast('Preset saved ✅');
    });
    $('#load').addEventListener('click', () => {
      const raw = localStorage.getItem('sportcar_config');
      if(!raw) return toast('No preset found');
      const data = JSON.parse(raw);
      Object.assign(config, data);
      syncUI(); apply(); toast('Preset loaded');
    });
    $('#reset').addEventListener('click', () => {
      Object.assign(config, { name:'Vortex GT', body:'#ff3b3b', accent:'#00e5ff', underglow:'#00e5ff', rim:'split5', wheel:20, ride:-15, tint:35, stripe:'off', spoiler:'off', dark:true });
      syncUI(); apply(); toast('Reset to defaults');
    });
    $('#random').addEventListener('click', () => {
      const rc = () => '#'+Math.floor(Math.random()*0xffffff).toString(16).padStart(6,'0');
      const rims = ['split5','mesh','turbine'];
      const stripes = ['off','center','dual'];
      const spoilers = ['off','lip','gt'];
      Object.assign(config, {
        body: rc(), accent: rc(), underglow: rc(), rim: rims[Math.floor(Math.random()*rims.length)],
        wheel: 16+Math.floor(Math.random()*9), ride: -40+Math.floor(Math.random()*81), tint: [0,15,25,35,50,70].sort(()=>.5-Math.random())[0],
        stripe: stripes[Math.floor(Math.random()*stripes.length)], spoiler: spoilers[Math.floor(Math.random()*spoilers.length)]
      });
      syncUI(); apply(); toast('Randomized ✨');
    });

    // Export PNG (SVG -> Canvas -> PNG)
    $('#exportPNG').addEventListener('click', () => {
      const svg = document.getElementById('carSvg');
      const clone = svg.cloneNode(true);
      clone.querySelector('.badge')?.remove();
      const xml = new XMLSerializer().serializeToString(clone);
      const svg64 = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(xml);
      const img = new Image();
      const canvas = document.createElement('canvas');
      canvas.width = 1600; canvas.height = 800; // export size
      const ctx = canvas.getContext('2d');
      img.onload = () => {
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg') || '#0b0f14';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        const ratio = Math.min(canvas.width/img.width, canvas.height/img.height) * 0.86;
        const w = img.width*ratio, h = img.height*ratio;
        ctx.drawImage(img, (canvas.width-w)/2, (canvas.height-h)/2, w, h);
        const link = document.createElement('a');
        link.download = (config.name || 'car') + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      };
      img.src = svg64;
    });

    // Tiny toast
    function toast(msg){
      const el = document.createElement('div');
      el.textContent = msg;
      Object.assign(el.style, { position:'fixed', left:'50%', top:'20px', transform:'translateX(-50%)', padding:'10px 14px', background:'rgba(0,0,0,.75)', color:'#fff', borderRadius:'999px', zIndex:9999, border:'1px solid rgba(255,255,255,.15)', fontSize:'13px', letterSpacing:'.2px' });
      document.body.appendChild(el);
      setTimeout(()=>{ el.remove(); }, 1600);
    }

    // Drag to reveal underglow parallax
    (function(){
      const svg = $('#carSvg');
      let dragging = false; let startX = 0; let startCx = +underGlow.getAttribute('cx');
      svg.addEventListener('mousedown', (e)=>{ dragging=true; startX=e.clientX; startCx=+underGlow.getAttribute('cx'); svg.style.cursor='grabbing'; });
      window.addEventListener('mouseup', ()=>{ dragging=false; svg.style.cursor='grab'; });
      window.addEventListener('mousemove', (e)=>{
        if(!dragging) return; const dx = e.clientX - startX; underGlow.setAttribute('cx', startCx + dx/2);
      });
      // Touch
      svg.addEventListener('touchstart', (e)=>{ dragging=true; startX=e.touches[0].clientX; startCx=+underGlow.getAttribute('cx'); });
      window.addEventListener('touchend', ()=>{ dragging=false; });
      window.addEventListener('touchmove', (e)=>{ if(!dragging) return; const dx=e.touches[0].clientX-startX; underGlow.setAttribute('cx', startCx + dx/2); });
    })();

    // Init from storage if exists
    const preset = localStorage.getItem('sportcar_config');
    if(preset){ Object.assign(config, JSON.parse(preset)); }
    syncUI(); apply();
  </script>
</body>
</html>
